<!DOCTYPE html>
<html class="spectrum spectrum--medium spectrum--light">

<head>
    <meta charset="utf-8" />
    <title>Commerce Product Picker</title>
    <link rel="stylesheet" type="text/css" crossorigin
        href="https://static-cif.adobeaemcloud.com/src.stable.latest.css" />
    <style type="text/css">
        .react-spectrum-provider {
            margin: 50px;
        }
    </style>
</head>

<body>
    <noscript>You need to enable JavaScript to run this app.</noscript>

    <product-field name="./product" placeholder="Product SKU" selection-id="combinedSku" multiple
        filter="folderOrProductOrVariant" aria-required="true" configs="<%= configs %>" target="#products">
    </product-field>

    <div id="products" style="display: none;" class="react-spectrum-provider">
        <h2 class="spectrum-Heading spectrum-Heading--sizeM">Selected Products</h2>
        <table class="spectrum-Table" style="border: 1px solid black;">
            <thead class="spectrum-Table-head">
                <tr>
                    <th class="spectrum-Table-headCell">Product SKU</th>
                    <th class="spectrum-Table-headCell">Product Name</th>
                    <th class="spectrum-Table-headCell">Image</th>
                </tr>
            </thead>
            <tbody class="spectrum-Table-body">
            </tbody>
        </table>
    </div>

    <script type="application/javascript">
        let configs = [];
        configs.push({ "instanceUrl": "https://adobeioruntime.net/api/v1/web/mbecker/default/io-proxy.http/graphql", "rootCategory": "Mg==", "storeView": "default", "enableUIDSupport": "true" });
        document.getElementsByTagName("product-field")[0].setAttribute("configs", JSON.stringify(configs))
    </script>

    <script type="application/javascript" crossorigin async="true"
        src="https://static-cif.adobeaemcloud.com/src.stable.latest.js"></script>
    <script>
        function createTag(name, attrs) {
            const el = document.createElement(name);
            if (typeof attrs === 'object') {
                for (const [key, value] of Object.entries(attrs)) {
                    el.setAttribute(key, value);
                }
            }
            return el;
        }

        function handleAddValue(event) {
            var value = event.detail.value;

            var products = document.querySelector("#products");
            products.style.display = "block";

            var tableBody = products.querySelector("table tbody");
            var row = createTag("tr", { id: "p-" + value, class: "spectrum-Table-row" });
            var cellSku = createTag("td", {class: "spectrum-Table-cell"});
            cellSku.innerHTML = value;
            var cellName = createTag("td",  { class: "spectrum-Table-cell" });
            cellName.innerHTML = "Product Name goes here"
            var cellImage = createTag("td",  { class: "spectrum-Table-cell" });
            cellImage.innerHTML = "Product Asset goes here"
            row.appendChild(cellSku);
            row.appendChild(cellName);
            row.appendChild(cellImage);
            tableBody.appendChild(row);
        }

        function handleRemoveValue(event) {
            var value = event.detail.value;
            var products = document.querySelector("#products");
            var productRow = products.querySelector("table tbody #p-" + value);
            productRow.remove();
        }


        // document.querySelector("#products").addEventListener('cif:update-value', () => {
        //     console.log("Product - change")
        // });
        document.querySelector("#products").addEventListener('cif:add-value', handleAddValue);
        document.querySelector("#products").addEventListener('cif:remove-value', handleRemoveValue);
    </script>
</body>

</html>